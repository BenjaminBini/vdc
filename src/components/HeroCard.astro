---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  href: string;
  media?: ImageMetadata | string;
  mediaType?: 'image' | 'video';
  alt?: string;
  title?: string;
  titleSize?: 'small' | 'large';
  overlay?: boolean | string;
  bg?: string;
  animate?: 'fade-up' | 'fade-down' | 'fade-left' | 'fade-right' | 'zoom-in' | 'fade' | false;
  class?: string;
}

const {
  href,
  media,
  mediaType = 'image',
  alt = '',
  title,
  titleSize = 'small',
  overlay = false,
  bg,
  animate = 'fade-up',
  class: className = ''
} = Astro.props;

const hasSlot = Astro.slots.has('default');
const overlayClass = typeof overlay === 'string' ? overlay : (overlay ? 'bg-beaucharme-dark/40' : '');

// Handle media URL for videos (strings only)
const baseUrl = import.meta.env.BASE_URL;
const isImportedImage = media && typeof media !== 'string';
const videoUrl = !isImportedImage && media && typeof media === 'string' && media.startsWith('/') && !media.startsWith('//')
  ? `${baseUrl}${media}`
  : media;
---

<a
  href={href}
  class:list={[
    'group bg-white relative rounded-2xl shadow-md/40 overflow-hidden transition-[shadow,transform] duration-300 hover:shadow-2xl/40 hover:scale-[1.05]',
    bg,
    !media && 'flex items-center justify-center',
    className
  ]}
  data-animate={animate || undefined}
>
  {media && mediaType === 'video' && typeof media === 'string' && (
    <video
      src={videoUrl as string}
      muted
      loop
      playsinline
      autoplay
      class="w-full h-full object-cover transition-transform duration-1000 ease-out group-hover:scale-110"
    />
  )}

  {media && mediaType === 'image' && isImportedImage && (
    <Image
      src={media as ImageMetadata}
      alt={alt}
      width={800}
      height={600}
      class="w-full h-full object-cover transition-transform duration-1000 ease-out group-hover:scale-110"
    />
  )}

  {media && mediaType === 'image' && !isImportedImage && typeof media === 'string' && (
    <Image
      src={media}
      alt={alt}
      width={800}
      height={600}
      class="w-full h-full object-cover transition-transform duration-1000 ease-out group-hover:scale-110"
    />
  )}

  {overlay && (
    <div class:list={['absolute inset-0', overlayClass]} />
  )}

  {hasSlot && (
    <slot />
  )}

  {title && !hasSlot && (
    <>
      <div class="absolute inset-0 bg-gradient-to-t from-beaucharme-dark/70 via-beaucharme-dark/20 to-transparent" />
      <div class="absolute inset-0 p-5 md:p-8 flex flex-col justify-end">
        <h3 class="font-serif font-semibold text-white text-[2rem] leading-8">{title}</h3>
      </div>
    </>
  )}
</a>
