---
interface Props {
  href: string;
  media?: string;
  mediaType?: 'image' | 'video';
  alt?: string;
  title?: string;
  titleSize?: 'small' | 'large';
  overlay?: boolean | string;
  bg?: string;
  class?: string;
}

const {
  href,
  media,
  mediaType = 'image',
  alt = '',
  title,
  titleSize = 'small',
  overlay = false,
  bg,
  class: className = ''
} = Astro.props;

const hasSlot = Astro.slots.has('default');
const overlayClass = typeof overlay === 'string' ? overlay : (overlay ? 'bg-beaucharme-dark/40' : '');

// Prepend base URL for local assets
const baseUrl = import.meta.env.BASE_URL;
const mediaUrl = media && media.startsWith('/') && !media.startsWith('//') ? `${baseUrl}${media.slice(1)}` : media;
---

<a
  href={href}
  class:list={[
    'bg-white relative rounded-2xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2',
    bg,
    !media && 'flex items-center justify-center',
    className
  ]}
>
  {media && mediaType === 'video' && (
    <video
      src={mediaUrl}
      muted
      loop
      playsinline
      autoplay
      class="w-full h-full object-cover"
    />
  )}

  {media && mediaType === 'image' && (
    <img
      src={mediaUrl}
      alt={alt}
      class="w-full h-full object-cover"
    />
  )}

  {overlay && (
    <div class:list={['absolute inset-0', overlayClass]} />
  )}

  {hasSlot && (
    <slot />
  )}

  {title && !hasSlot && (
    <>
      <div class="absolute inset-0 bg-gradient-to-t from-beaucharme-dark/70 via-beaucharme-dark/20 to-transparent" />
      <div class="absolute inset-0 p-5 md:p-8 flex flex-col justify-end">
        <h3 class="font-serif font-semibold text-white text-[2rem] leading-8">{title}</h3>
      </div>
    </>
  )}
</a>
