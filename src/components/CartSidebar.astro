---
---

<!-- Cart Sidebar -->
<div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full md:w-[450px] bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300">
  <div class="flex flex-col h-full">
    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b border-beaucharme-beige">
      <h2 class="font-serif text-2xl font-semibold text-beaucharme-dark">Votre Panier</h2>
      <button
        data-cart-close
        class="p-2 hover:bg-beaucharme-cream rounded-full transition-colors duration-300"
        aria-label="Fermer"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <!-- Cart Items -->
    <div id="cart-items" class="flex-1 overflow-y-auto p-6">
      <!-- Items will be rendered here by JavaScript -->
    </div>

    <!-- Footer -->
    <div class="border-t border-beaucharme-beige p-6 bg-beaucharme-cream/30">
      <div class="space-y-4">
        <div class="flex justify-between items-center text-lg">
          <span class="font-medium text-beaucharme-dark">Sous-total</span>
          <span id="cart-subtotal" class="font-serif text-2xl font-semibold text-beaucharme-dark">0,00 €</span>
        </div>

        <p class="text-sm text-beaucharme-earth/80">
          Frais de livraison calculés à la prochaine étape
        </p>

        <button
          id="checkout-btn"
          class="w-full btn-primary"
          onclick="handleCheckout()"
        >
          Passer commande
        </button>

        <button
          data-cart-close
          class="w-full btn-secondary"
        >
          Continuer mes achats
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Overlay -->
<div
  id="cart-overlay"
  class="fixed inset-0 bg-black/50 z-40 hidden"
  data-cart-close
></div>

<script is:inline>
  function renderCartItems() {
    const cart = window.beaucharmeCart;
    const itemsContainer = document.getElementById('cart-items');
    const subtotalElement = document.getElementById('cart-subtotal');
    const overlay = document.getElementById('cart-overlay');
    const sidebar = document.getElementById('cart-sidebar');

    if (!itemsContainer || !subtotalElement) return;

    // Show/hide overlay based on sidebar state
    const isSidebarOpen = !sidebar?.classList.contains('translate-x-full');
    if (overlay) {
      overlay.classList.toggle('hidden', !isSidebarOpen);
    }

    if (cart.items.length === 0) {
      itemsContainer.innerHTML = `
        <div class="flex flex-col items-center justify-center h-full text-center">
          <svg class="w-24 h-24 text-beaucharme-beige mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
          </svg>
          <p class="text-beaucharme-earth text-lg mb-2">Votre panier est vide</p>
          <p class="text-beaucharme-earth/70 text-sm">Découvrez nos produits naturels</p>
        </div>
      `;
      subtotalElement.textContent = '0,00 €';
      return;
    }

    itemsContainer.innerHTML = cart.items.map((item) => `
      <div class="flex space-x-4 mb-6 pb-6 border-b border-beaucharme-beige last:border-0">
        <img
          src="${item.image}"
          alt="${item.name}"
          class="w-24 h-24 object-cover rounded-sm"
        />
        <div class="flex-1">
          <h3 class="font-medium text-beaucharme-dark mb-1">${item.name}</h3>
          <p class="text-sm text-beaucharme-earth/70 mb-3">${item.price.toFixed(2).replace('.', ',')} €</p>

          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2 border border-beaucharme-beige rounded-sm">
              <button
                onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})"
                class="px-3 py-1 hover:bg-beaucharme-cream transition-colors duration-300"
                aria-label="Diminuer"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                </svg>
              </button>
              <span class="px-3 font-medium">${item.quantity}</span>
              <button
                onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})"
                class="px-3 py-1 hover:bg-beaucharme-cream transition-colors duration-300"
                aria-label="Augmenter"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
              </button>
            </div>

            <button
              onclick="removeFromCart('${item.id}')"
              class="text-beaucharme-earth/70 hover:text-red-600 transition-colors duration-300"
              aria-label="Supprimer"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    `).join('');

    subtotalElement.textContent = cart.getTotal().toFixed(2).replace('.', ',') + ' €';
  }

  window.updateCartQuantity = function(productId, quantity) {
    window.beaucharmeCart.updateQuantity(productId, quantity);
    renderCartItems();
  }

  window.removeFromCart = function(productId) {
    window.beaucharmeCart.removeItem(productId);
    renderCartItems();
  }

  window.handleCheckout = function() {
    alert('Merci pour votre commande ! Cette fonctionnalité sera bientôt disponible. (Interface de démonstration)');
  }

  // Listen for cart updates
  window.addEventListener('cart-updated', () => {
    renderCartItems();
  });

  // Initial render
  document.addEventListener('DOMContentLoaded', () => {
    renderCartItems();
  });

  // Update overlay when sidebar state changes
  const sidebar = document.getElementById('cart-sidebar');
  if (sidebar) {
    const observer = new MutationObserver(() => {
      const overlay = document.getElementById('cart-overlay');
      const isSidebarOpen = !sidebar.classList.contains('translate-x-full');
      if (overlay) {
        overlay.classList.toggle('hidden', !isSidebarOpen);
      }
    });

    observer.observe(sidebar, {
      attributes: true,
      attributeFilter: ['class']
    });
  }
</script>
