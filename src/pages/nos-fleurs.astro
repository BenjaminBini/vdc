---
import type { ImageMetadata } from 'astro';
import Layout from '@layouts/Layout.astro';
import Header from '@components/Header.astro';
import Footer from '@components/Footer.astro';
import CartSidebar from '@components/CartSidebar.tsx';
import PageContainer from '@components/PageContainer.astro';
import HeroCard from '@components/HeroCard.astro';
import plants from '@data/plants.json';

// Import all plant images
const plantImages = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/plants/*.{jpg,jpeg,png}', { eager: true });

// Helper to get plant image
function getPlantImage(imagePath: string): ImageMetadata | string {
  const fileName = imagePath.split('/').pop();
  const key = `/src/assets/images/plants/${fileName}`;
  return plantImages[key]?.default || imagePath;
}

const baseUrl = import.meta.env.BASE_URL;

// Grid position classes for bento layout (10 plants)
const gridClasses = [
  'sm:col-span-2 md:row-span-2',  // bourrache - large
  'sm:col-span-2 md:col-span-2',  // cameline
  'sm:col-span-2 md:col-span-2',  // camomille
  'sm:col-span-2 md:col-span-2',  // carthame
  'sm:col-span-2 md:row-span-2',  // chanvre - large
  'sm:col-span-2 md:col-span-2',  // laurier
  'sm:col-span-2 md:col-span-2',  // lavandin
  'sm:col-span-2 md:row-span-2',  // menthe - large
  'sm:col-span-2 md:col-span-2',  // sauge
  'sm:col-span-2 md:col-span-2',  // tournesol
];
---

<Layout title="Nos Fleurs" description="Découvrez les 10 plantes cultivées sur notre ferme en Bourgogne pour créer nos cosmétiques naturels.">
  <PageContainer>
    <Header />

    <!-- Bento Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-6 gap-3 md:gap-4">
      <!-- Title Card -->
      <div class="sm:col-span-2 bg-beaucharme-sage-dark rounded-2xl p-6 md:p-8 flex flex-col justify-center text-white" data-animate="fade-up">
        <p class="text-sm tracking-[0.2em] uppercase mb-2 text-white/70">De notre ferme</p>
        <h1 class="font-serif text-3xl md:text-4xl font-bold mb-3">Nos Fleurs</h1>
        <p class="text-white/80 text-sm md:text-base">
          10 plantes cultivées avec passion dans l'Yonne pour créer nos cosmétiques naturels.
        </p>
      </div>

      {plants.map((plant, index) => {
        const img = getPlantImage(plant.image);
        return (
          <HeroCard
            href={`${baseUrl}/nos-fleurs/${plant.id}`}
            media={img}
            alt={plant.name}
            class={`min-h-[200px] ${gridClasses[index]}`}
          >
            <div class="absolute inset-0 bg-gradient-to-t from-beaucharme-dark/80 via-beaucharme-dark/20 to-transparent" />
            <div class="absolute inset-0 p-5 md:p-6 flex flex-col justify-end">
              <span class="text-white/60 text-xs italic">{plant.latinName}</span>
              <h3 class="font-serif text-xl md:text-2xl font-semibold text-white mt-1">{plant.name}</h3>
              <p class="text-white/70 text-sm mt-1 line-clamp-2 hidden md:block">{plant.shortDescription}</p>
            </div>
          </HeroCard>
        );
      })}

      <!-- CTA Card -->
      <div class="sm:col-span-2 bg-beaucharme-terracotta rounded-2xl p-6 md:p-8 flex flex-col justify-center text-white" data-animate="fade-up">
        <h2 class="font-serif text-2xl font-semibold mb-3">De la fleur au flacon</h2>
        <p class="text-white/80 text-sm mb-4">
          Découvrez comment nous transformons nos plantes en cosmétiques naturels.
        </p>
        <a href={`${baseUrl}/de-la-fleur-au-flacon`} class="inline-block bg-white text-beaucharme-terracotta px-6 py-2 rounded-full font-semibold text-sm hover:bg-beaucharme-cream transition-colors w-fit">
          En savoir plus
        </a>
      </div>
    </div>

    <Footer />
    <CartSidebar />
  </PageContainer>
</Layout>
