---
import Layout from '@layouts/Layout.astro';
import Header from '@components/Header.astro';
import Footer from '@components/Footer.astro';
import Newsletter from '@components/Newsletter.astro';
import CartSidebar from '@components/CartSidebar.tsx';
import PageContainer from '@components/PageContainer.astro';
import Section from '@components/Section.astro';
import FeatureCard from '@components/FeatureCard.astro';
import StoreFilters from '@components/StoreFilters.tsx';
import FilteredProductGrid from '@components/FilteredProductGrid.tsx';
import MobileFilterToggle from '@components/MobileFilterToggle.tsx';
import ProductService from '@services/ProductService';

const baseUrl = import.meta.env.BASE_URL;
const categories = ProductService.getAllCategories();
const plants = ProductService.getPlantSummaries();
const products = ProductService.withBaseUrl(ProductService.getAllProducts(), baseUrl);
const [minPrice, maxPrice] = ProductService.getPriceRange().map((p, i) => i === 0 ? Math.floor(p) : Math.ceil(p));
---

<Layout title="Boutique" description="Découvrez tous nos cosmétiques naturels fabriqués à la ferme : huiles végétales, crèmes, savons, eaux florales et coffrets.">
  <PageContainer>
    <Header />

    <!-- Modern Boutique Hero -->
    <section class="relative overflow-hidden rounded-2xl bg-beaucharme-terracotta">
      <!-- Decorative elements -->
      <div class="absolute inset-0 opacity-10">
        <div class="absolute top-0 right-0 w-96 h-96 bg-white rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
        <div class="absolute bottom-0 left-0 w-64 h-64 bg-beaucharme-cream rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"></div>
      </div>

      <div class="relative z-10 px-8 py-6 md:py-6 text-center">
        <p class="text-sm tracking-[0.3em] uppercase mb-3 text-white/60">Nos créations</p>
        <h1 class="font-serif text-4xl md:text-5xl font-bold text-white mb-3">Boutique</h1>
        <p class="text-white/80 max-w-md mx-auto">Cosmétiques naturels créés avec passion dans notre ferme bourguignonne</p>
      </div>
    </section>

    <div class="py-8">
      <!-- Mobile Filter Toggle -->
      <MobileFilterToggle
        client:load
        categories={categories}
        plants={plants}
        minPrice={minPrice}
        maxPrice={maxPrice}
      />

      <div class="flex flex-col lg:flex-row gap-8">
        <!-- Filters Sidebar (Desktop) -->
        <aside class="hidden lg:block lg:w-72 flex-shrink-0">
          <div class="lg:sticky lg:top-24 max-h-[calc(100vh-7rem)] overflow-y-auto">
            <Section bg="white" padding="none" class="p-6">
              <div class="flex items-baseline gap-2 mb-6">
                <h2 class="font-serif text-2xl font-semibold text-beaucharme-dark">Filtres</h2>
                <span id="product-count" class="text-sm text-beaucharme-earth"></span>
              </div>
              <StoreFilters
                client:load
                categories={categories}
                plants={plants}
                minPrice={minPrice}
                maxPrice={maxPrice}
              />
            </Section>
          </div>
        </aside>

        <!-- Products Grid -->
        <div class="flex-1">
          <FilteredProductGrid
            client:load
            products={products}
            categories={categories}
            plants={plants}
            minPrice={minPrice}
            maxPrice={maxPrice}
            baseUrl={baseUrl}
          />
        </div>
      </div>
    </div>

    <Section bg="transparent" card={false} padding="small">
      <div class="container-custom">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <FeatureCard title="Livraison soignée" description="Expédition rapide et emballage éco-responsable pour protéger vos produits" iconColor="sage">
            <svg slot="icon" class="w-8 h-8 text-beaucharme-sage" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
            </svg>
          </FeatureCard>

          <FeatureCard title="Qualité garantie" description="Tous nos produits sont certifiés COSMOS et fabriqués dans notre ferme" iconColor="terracotta">
            <svg slot="icon" class="w-8 h-8 text-beaucharme-terracotta" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </FeatureCard>

          <FeatureCard title="À votre écoute" description="Une question ? Nous sommes là pour vous conseiller et vous accompagner" iconColor="gold">
            <svg slot="icon" class="w-8 h-8 text-beaucharme-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
            </svg>
          </FeatureCard>
        </div>
      </div>
    </Section>

    <Newsletter />
    <Footer />
    <CartSidebar client:load />
  </PageContainer>
</Layout>

<script is:inline>
  // Handle hash navigation for direct product links
  if (window.location.hash) {
    const productId = window.location.hash.substring(1);
    const productElement = document.getElementById(productId);
    if (productElement) {
      setTimeout(() => {
        productElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        productElement.style.animation = 'pulse 1s ease-in-out';
      }, 100);
    }
  }
</script>

<style>
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }
</style>
