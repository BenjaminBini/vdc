---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ProductCard from '../components/ProductCard.astro';
import Newsletter from '../components/Newsletter.astro';
import CartSidebar from '../components/CartSidebar.tsx';
import PageContainer from '../components/PageContainer.astro';
import HeroSection from '../components/HeroSection.astro';
import Section from '../components/Section.astro';
import FeatureCard from '../components/FeatureCard.astro';
import productsData from '../data/products.json';

const { products, categories } = productsData;
---

<Layout title="Boutique" description="Découvrez tous nos cosmétiques naturels fabriqués à la ferme : huiles végétales, crèmes, savons, eaux florales et coffrets.">
  <PageContainer>
    <Header />

    <HeroSection
      image="/images/boutique-hero.jpg"
      alt="Nos produits cosmétiques"
      tagline="Nos créations"
      title="Boutique"
      subtitle="Cosmétiques naturels créés avec passion dans notre ferme bourguignonne"
      height="small"
    />

    <Section bg="white" padding="normal" fullWidth card={false}>
      <div class="container-custom">
        <!-- Filters -->
        <div class="mb-12">
          <div class="flex flex-wrap gap-3 justify-center">
            <button data-filter="all" class="filter-btn active">
              Tous les produits
            </button>
            {categories.map(category => (
              <button data-filter={category.id} class="filter-btn">
                {category.name}
              </button>
            ))}
          </div>
        </div>

        <!-- Products Grid -->
        <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
          {products.map(product => (
            <div class="product-item animate-on-scroll" data-category={product.category}>
              <ProductCard {...product} />
            </div>
          ))}
        </div>

        <!-- No Results Message -->
        <div id="no-results" class="hidden text-center py-16">
          <svg class="w-24 h-24 text-beaucharme-beige mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <p class="text-beaucharme-earth text-lg">Aucun produit trouvé dans cette catégorie</p>
        </div>
      </div>
    </Section>

    <Section bg="transparent" card={false} padding="normal">
      <div class="container-custom">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <FeatureCard title="Livraison soignée" description="Expédition rapide et emballage éco-responsable pour protéger vos produits" iconColor="sage">
            <svg slot="icon" class="w-8 h-8 text-beaucharme-sage" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
            </svg>
          </FeatureCard>

          <FeatureCard title="Qualité garantie" description="Tous nos produits sont certifiés COSMOS et fabriqués dans notre ferme" iconColor="terracotta">
            <svg slot="icon" class="w-8 h-8 text-beaucharme-terracotta" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </FeatureCard>

          <FeatureCard title="À votre écoute" description="Une question ? Nous sommes là pour vous conseiller et vous accompagner" iconColor="gold">
            <svg slot="icon" class="w-8 h-8 text-beaucharme-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
            </svg>
          </FeatureCard>
        </div>
      </div>
    </Section>

    <Newsletter />
    <Footer />
    <CartSidebar client:load />
  </PageContainer>
</Layout>

<script is:inline>
  // Filter functionality
  const filterButtons = document.querySelectorAll('.filter-btn');
  const productItems = document.querySelectorAll('.product-item');
  const noResults = document.getElementById('no-results');

  filterButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const filter = button.dataset.filter;

      // Update active button
      filterButtons.forEach((btn) => btn.classList.remove('active'));
      button.classList.add('active');

      // Filter products
      let visibleCount = 0;
      productItems.forEach((item) => {
        const htmlElement = item;
        const category = htmlElement.dataset.category;
        if (filter === 'all' || category === filter) {
          htmlElement.style.display = 'block';
          visibleCount++;
        } else {
          htmlElement.style.display = 'none';
        }
      });

      // Show/hide no results message
      if (noResults) {
        if (visibleCount === 0) {
          noResults.classList.remove('hidden');
        } else {
          noResults.classList.add('hidden');
        }
      }
    });
  });

  // Handle hash navigation for direct product links
  if (window.location.hash) {
    const productId = window.location.hash.substring(1);
    const productElement = document.getElementById(productId);
    if (productElement) {
      setTimeout(() => {
        productElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        productElement.style.animation = 'pulse 1s ease-in-out';
      }, 100);
    }
  }
</script>

<style>
  .filter-btn {
    @apply px-6 py-3 rounded-sm border-2 border-beaucharme-beige text-beaucharme-dark
           font-medium tracking-wide transition-all duration-300
           hover:border-beaucharme-sage hover:bg-beaucharme-sage/10;
  }

  .filter-btn.active {
    @apply bg-beaucharme-terracotta border-beaucharme-terracotta text-white
           hover:bg-beaucharme-terracotta-dark hover:border-beaucharme-terracotta-dark;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }
</style>
