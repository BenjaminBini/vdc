---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
}

const { title, description = "Beaucharme Cosmétique - De la graine au flacon" } = Astro.props;
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | Beaucharme Cosmétique</title>
  </head>
  <body class="bg-grain bg-beaucharme-beige">
    <div class="relative z-10">
      <slot />
    </div>

    <script is:inline>
      // Scroll reveal animation
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            // Once visible, stop observing (animation plays only once)
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);

      // Function to observe all animatable elements
      function observeAnimatedElements() {
        document.querySelectorAll('[data-animate]:not(.is-visible)').forEach((el) => {
          observer.observe(el);
        });
      }

      // Initial observation
      observeAnimatedElements();

      // Re-observe when React components hydrate (MutationObserver)
      const mutationObserver = new MutationObserver((mutations) => {
        let shouldObserve = false;
        mutations.forEach((mutation) => {
          if (mutation.addedNodes.length > 0) {
            shouldObserve = true;
          }
        });
        if (shouldObserve) {
          observeAnimatedElements();
        }
      });

      mutationObserver.observe(document.body, {
        childList: true,
        subtree: true
      });

      // Handle add to cart button clicks (for Astro components that use data attributes)
      document.addEventListener('click', (e) => {
        const target = e.target;
        const addToCartBtn = target.closest('[data-add-to-cart]');
        if (addToCartBtn && window.beaucharmeCart) {
          const productData = addToCartBtn.dataset.product;
          if (productData) {
            const product = JSON.parse(productData);
            window.beaucharmeCart.addItem(product);

            // Show feedback
            addToCartBtn.textContent = 'Ajouté !';
            addToCartBtn.classList.add('bg-beaucharme-sage');
            setTimeout(() => {
              addToCartBtn.textContent = 'Ajouter au panier';
              addToCartBtn.classList.remove('bg-beaucharme-sage');
            }, 1500);
          }
        }

        // Mobile menu toggle
        const menuToggle = target.closest('[data-menu-toggle]');
        if (menuToggle) {
          const mobileMenu = document.getElementById('mobile-menu');
          if (mobileMenu) {
            mobileMenu.classList.toggle('hidden');
            document.body.classList.toggle('overflow-hidden');
          }
        }
      });
    </script>
  </body>
</html>
